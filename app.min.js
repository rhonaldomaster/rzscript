// ==UserScript==
// @name           rzscript
// @namespace      rzscript
// @description    Optimized version of original MZScript
// @include        http://*managerzone.*
// @grant          none
// @version        0.1
// @copyright      GNU/GPL v3
// @authors        rhonaldomaster
// @credits        MZScript por c_c (c_c@managerzone.com) | serbocapo (serbocapo@managerzone.com)
// ==/UserScript==
var rzscript=function(){var t=["","soccer","hockey"],e=function(){r(),n(),o(),B(),K(),i(),l(),m(),q(),T(),j(),_(),C(),V(),setTimeout(function(){u()},500),$(document).on("click",".training_report_header",l)},r=function(){var t="#pt-wrapper{bottom:52px;filter:alpha(opacity=50);opacity:0.5;}#notifications-wrapper{bottom:-2px;}.quicklink{background-color:#4A4A4A;border:0;border-radius:4px;box-shadow:0 0 1px 0 #000;color:#FFF;cursor:pointer;display:inline-block;margin-left:4px;padding:2px 4px;text-decoration:none;transition:0.2s ease-in-out all;}.quicklink:hover{background-color:#000000;box-shadow:0 0 2px 0 #000000;color:#FFFFFF;transform:scale(1.1);text-decoration:none;}.quicklinks{padding:0 4px 8px;text-align:center;}#fluid-menu-opener > div.sport-line,#top-wrapper-sport-line{background:#5d5b5f none repeat scroll 0 0;}";if("undefined"!=typeof GM_addStyle)GM_addStyle(t);else if("undefined"!=typeof PRO_addStyle)PRO_addStyle(t);else if("undefined"!=typeof addStyle)addStyle(t);else{var e=document.querySelectorAll("head");if(e.length>0){var r=document.createElement("style");r.type="text/css",r.appendChild(document.createTextNode(t)),e[0].appendChild(r)}}},i=function(){var t=document.querySelector("#match-info-wrapper");if(t){var e=t.querySelector("h1"),r=e.innerHTML,i=["Liga","League"];i.indexOf(r)>-1&&(e.innerHTML='<a href="?p=league&type=senior">'+r+"</a>")}},a=function(t,e,r,i,a){for(var n=document.querySelector(t+e),o="",l="<div "+("."==t?"class":"id")+'="'+e+'">',s=0;s<i.length;s++)o=i[s].url.indexOf("?p=")<0?' target="_blank"':"",l+='<a class="quicklink" href="'+i[s].url+'"'+o+' title="'+i[s].title+'">'+i[s].text+"</a>";if(l+="</div>",!n){var c=a?"afterbegin":"beforeend";r.insertAdjacentHTML(c,l)}},n=function(){var t=[{text:"MER",title:"Mercado(Transfers)",url:"?p=forum&sub=topics&forum_id=254&sport=soccer"},{text:"AMI",title:"Amistosos",url:"?p=forum&sub=topics&forum_id=249&sport=soccer"},{text:"MZH",title:"MZ Habla",url:"?p=forum&sub=topics&forum_id=253&sport=soccer"},{text:"PYR",title:"Preguntas y Respuestas",url:"?p=forum&sub=topics&forum_id=255&sport=soccer"},{text:"DA",title:"Discusi&oacute;n Abierta",url:"?p=forum&sub=topics&forum_id=250&sport=soccer"},{text:"FED",title:"Federaciones",url:"?p=forum&sub=topics&forum_id=251&sport=soccer"},{text:"HDC",title:"Hablemos de copas",url:"?p=forum&sub=topics&forum_id=252&sport=soccer"}];a(".","js-forum-buttons .quicklinks",document.querySelector("#notifications-wrapper"),t,!1)},o=function(){var t=[{text:"Monitoreo",title:"Monitoreo",url:"?p=transfer&sub=yourplayers"},{text:"Vista Alternativa",title:"Ver Vista Alternativa",url:"?p=players&sub=alt"},{text:"Seguimiento",title:"Ir a Seguimiento",url:"?p=shortlist"},{text:"Finanzas",title:"Ver Finanzas",url:"?p=economy"},{text:"Mercado",title:"Ver Mercado",url:"?p=transfer"},{text:"Jugados",title:"Ver los Partidos Jugados",url:"?p=match&sub=played"},{text:"Pr&oacute;ximos",title:"Ver los Pr&oacute;ximos Partidos",url:"?p=match&sub=scheduled"},{text:"T&aacute;cticas",title:"Ir a T&aacute;cticas",url:"?p=tactics"},{text:"Lesiones/Sanciones",title:"Ver Lesionados/Sancionados",url:"?p=players&sub=unavailable"},{text:"Reporte entr.",title:"Ver el Reporte de Entrenamiento",url:"?p=training_report"},{text:"Entrenamiento",title:"Ir al Entrenamiento General",url:"?p=training"},{text:"MZ Plus",title:"Skiller MZ Plus",url:"http://mzplus.info/p"},{text:"Imgur",title:"Ir a Imgur",url:"http://imgur.com/"}];a(".","quicklinks",document.querySelector("#contentDiv"),t,!0)},l=function(){setTimeout(function(){var t=document.querySelector("#training_report");if(t)for(var e,r=t.childNodes[2],i=r.querySelector("tbody"),a=0,n=0;n<i.rows.length;n++)e=i.rows[n].cells[4],a=e.querySelectorAll("img").length,e.querySelector("div").innerHTML+="<b>("+a+")</b>"},1500)},s=function(t,e){var r={USD:7.4234,EUR:9.1775,SEK:1,MM:1,UYU:.256963,R$:2.62589,GBP:13.35247,DKK:1.23522,NOK:1.07245,CHF:5.86737,CAD:5.70899,AUD:5.66999,ILS:1.6953,MXN:.68576,ARS:2.64445,BOB:.939,PYG:.001309,RUB:.26313,PLN:1.95278,ISK:.10433,BGL:4.70738,BGN:4.70738,ZAR:1.23733,US$:7.4234,THB:.17079,SIT:.03896,SKK:.24946,JPY:.06,INR:.17,MZ:1},i=0,a=1/r[e],n=localStorage.getItem("moneda");return i=n?Math.round(1/r[cMoneda]*(t/a)):Math.round(1/r.USD*(t/a))},c=function(t){for(var e="",r=t.toString();r.length>3;)e="."+r.substr(r.length-3)+e,r=r.substring(0,r.length-3);return e=r+e},u=function(){if("soccer"==ajaxSport){var t,e=document.querySelectorAll(".team-table");if(e)for(var r=0;r<e.length;r++)t=e[r].querySelectorAll("a"),p(t[0].href.split("&")[1].split("=")[1],r)}},p=function(e,r){var i=document.querySelectorAll("#match-statistics .hitlist_wrapper_background table")[r];if(i){var a=$.ajax({url:"/xml/team_playerlist.php",type:"GET",data:{sport_id:t.indexOf(ajaxSport),team_id:e}});a.done(function(t){var e,r=null,a=0,n=0,o=0,l=0,u=i.rows[0],p=i.querySelector("tbody"),m=t.getElementsByTagName("TeamPlayers")[0].getAttribute("teamCurrency"),g=i.querySelector("tfoot"),f=g.rows[1];u.innerHTML="<td>Valor</td>"+u.innerHTML;for(var h=0;h<p.rows.length;h++)p.rows[h].querySelector("img")?p.rows[h].cells[0].colSpan="13":(e=p.rows[h].querySelector("a"),a=e.href.split("&")[1].split("=")[1],r=d(t,a),r&&(o+=1,l=s(r.getAttribute("value"),m),p.rows[h].innerHTML='<td style="width:62px;text-align:right;padding-right:15px">'+c(l)+"</td>"+p.rows[h].innerHTML,o<12&&(n+=l)));f.innerHTML='<td style="width:62px;text-align:right;padding-right:15px">'+c(n)+"</td>"+f.innerHTML,g.rows[3].cells[0].colSpan="13"})}},d=function(t,e){for(var r=null,i=t.getElementsByTagName("Player"),a=0;a<i.length;a++)e==i[a].getAttribute("id")&&(r=i[a]);return r},m=function(){var t=window.location.href.split("&");if("sub=topics"==t[1])for(var e,r,i,a,n,o,l,s=document.querySelectorAll("#topics-list > dd"),c=0;c<s.length;c++)if(e=s[c].querySelector(".topics-col-title").querySelector("a").getAttribute("href"),r=s[c].querySelector(".topics-col-counter"),i=(r.innerText||r.textContent).split(" / "),a=parseInt(i[1]),n=Math.floor(parseInt(a)/50),n>0&&a>50){o="",l=n>5?5:n+1;for(var u=2;u<l;u++)o+='<a href="'+e+"&offset="+50*(u-1)+'" title="Ir a p&aacute;gina '+u+'">'+u+"</a>&#160;";n>4&&(o+='<a href="'+e+"&offset="+(a%50==0?a-50:50*n)+'" title="Ir a &uacute;ltima p&aacute;gina">&#187;</a>&#160;'),n>1&&(o="["+o+"]"),r.insertAdjacentHTML("beforeend",o)}},g=function(){var t='<div><div class="mzbtn buttondiv button_account" title="Insertar Tabla LA-liga"><span class="buttonClassMiddle" style="white-space: nowrap" id="btnTabla">Tabla LA/liga</span><span class="buttonClassRight">&nbsp;</span></div><div class="mzbtn buttondiv button_account" title="Subir im&aacute;genes a ImgUr"><span class="buttonClassMiddle" style="white-space: nowrap" id="upImg">ImgUr</span><span class="buttonClassRight">&nbsp;</span></div><div class="mzbtn buttondiv button_account" title="Borrar texto del area de mensaje"><span class="buttonClassMiddle js-empty-post-textarea" style="white-space: nowrap">Vaciar</span><span class="buttonClassRight">&nbsp;</span></div><div class="js-icons-container"><img src="http://i.imgur.com/3YitWv3.gif" alt=">"/>&nbsp;<img src="http://i.imgur.com/Q3B4Dqz.gif" title="(y)" alt="(y)"/>&nbsp;<img src="http://i.imgur.com/vWFv3Gt.gif" title="(n)" alt="(n)"/>&nbsp;<img src="http://i.imgur.com/jaT1cb4.gif" height="20px" title="wtf" alt="wtf"/>&nbsp;<img src="http://i.imgur.com/VfbyDHO.gif" height="20px" title="fail" alt="fail"/>&nbsp;<img src="http://i.imgur.com/cheJFuk.gif" height="20px" title="repost" alt="repost"/>&nbsp;<img src="http://i.imgur.com/jDjyKTf.gif" title="cri" alt="cri"/>&nbsp;<img src="http://i.imgur.com/6PopX5q.gif" title="ha-ha" alt="ha-ha"/><img src="http://i.imgur.com/nRp5BpE.gif" title=":)" alt=":)"/>&nbsp;<img src="http://i.imgur.com/CcuKTNz.gif" title=":D" alt=":D"/>&nbsp;<img src="http://i.imgur.com/Dfl5ZGS.gif" title="D" alt="D"/>&nbsp;<img src="http://i.imgur.com/8t9ZJse.gif" title="xD" alt="xD"/>&nbsp;<img src="http://i.imgur.com/1kJhHCs.gif" title=":/" alt=":/"/>&nbsp;<img src="http://i.imgur.com/1ncAraF.gif" title=":(" alt=":("/>&nbsp;<img src="http://i.imgur.com/xp6xUJJ.gif" title=":*(" alt=":*("/>&nbsp;<img src="http://i.imgur.com/qOigaWi.png" title=":S" alt=":S"/>&nbsp;<img src="http://i.imgur.com/nITjZn5.gif" title="erm" alt="erm"/>&nbsp;<img src="http://i.imgur.com/rSqmTPO.gif" title="8-)" alt="8-)"/>&nbsp;<img src="http://i.imgur.com/qP1rAQ5.png" title="¬¬" alt="¬¬"/>&nbsp;<img src="http://i.imgur.com/HdNdWN0.png" title="porfi" alt="porfi"/>&nbsp;<img src="http://i.imgur.com/QuXS7fE.gif" title="O.O" alt="O.O"/>&nbsp;<img src="http://i.imgur.com/RUQN2Hy.gif" title="_hm" alt="_hm"/>&nbsp;<img src="http://i.imgur.com/QLCdFIE.gif" title=">:(" alt=">:("/>&nbsp;<img src="http://i.imgur.com/55sAO1r.gif" title=">:)" alt=">:)"/>&nbsp;<img src="http://i.imgur.com/KbQOSgw.gif" title="flirt" alt="flirt"/>&nbsp;<img src="http://i.imgur.com/t5dALqK.gif" title=":P" alt=":P"/>&nbsp;<img src="http://i.imgur.com/zpY2A6I.gif" title="|-(" alt="|-("/>&nbsp;<img src="http://i.imgur.com/yPtUjin.gif" title=";)" alt=";)"/>&nbsp;<img src="http://i.imgur.com/OOsLDaW.gif" title="(h)" alt="(h)"/>&nbsp;<img src="http://i.imgur.com/LdCQyai.png" title="u.u" alt="u.u"/>&nbsp;<img src="http://i.imgur.com/KnhAURP.gif" title="shh" alt="shh"/>&nbsp;<img src="http://i.imgur.com/BzPDfzF.gif" title="nana" alt="nana"/><img src="http://i.imgur.com/XEHiXuO.gif" height="23px" title="rock" alt="rock"/><img src="http://i.imgur.com/CsCrOnE.gif" title="grr" alt="grr"/>&nbsp;<img src="http://i.imgur.com/K2d1Mbv.gif" height="23px" title="jaja" alt="jaja"/><img src="http://i.imgur.com/SMcjsnf.gif" title="eah" alt="eah"/><img src="http://i.imgur.com/aaPvRo4.gif" title="clap" alt="clap"/><img src="http://i.imgur.com/av8bxvU.gif" title="bla" alt="bla"/><img src="http://i.imgur.com/oQYWBTO.gif" title="l" alt="l"/>&nbsp;<img src="http://i.imgur.com/z64hDgz.gif" title="grr" alt="grr"/>&nbsp;<img src="http://i.imgur.com/NA84WqF.gif" title="angel" alt="angel"/>&nbsp;<img src="http://i.imgur.com/N2cdFNy.gif" title="diablo" alt="diablo"/>&nbsp;<img src="http://i.imgur.com/YWe8hno.gif" title="baba" alt="baba"/><img src="http://i.imgur.com/1t7YpCo.gif" height="23px" title="x)" alt="x)"/>&nbsp;<img src="http://i.imgur.com/UR5t0o6.gif" title="plz" alt="plz"/>&nbsp;<img src="http://i.imgur.com/KKx3thu.gif" title="umm" alt="umm"/><img src="http://i.imgur.com/sC8Mgmi.gif" title="facepalm" alt="facepalm"/>&nbsp;<img src="http://i.imgur.com/gJw92DZ.gif title="zzz" alt="zzz"/><img src="http://i.imgur.com/RzjaSKr.gif" title="om" alt="om"/><img src="http://i.imgur.com/7iCxtYD.gif" title="uh" alt="uh"/></div><div id="contenedor" style="border: 5px solid green;font-weight:bold;display:none;width:430px; padding:5px;margin:auto">Arrastre su imagen a este espacio <button id="btnUpImg">O clickee ac&aacute; para elegirla</button> <input style="visibility: collapse; width: 0px;" id="subidor" type="file"><p id="error" style="font-weight:bold;color:red">Error. El archivo seleccionado no es una imagen.</p><p id="pe">Cargando imagen <img src="http://managerzone.se/img/loading.gif"> &nbsp;espere por favor.</p><p id="link"></p></div></div>';return t},f=function(t){t.preventDefault()},h=function(t){var e=document.querySelector("#link"),r=document.querySelector("#error"),i=document.querySelector("#pe");if(t&&t.type.match(/image.*/)){e.style.display="none",i.style.display="block",r.style.display="none";var a=new FormData;a.append("image",t);var n=$.ajax({type:"post",url:"https://api.imgur.com/3/upload.json",data:a,headers:{authorization:"Client-ID 4306d20a28c0e7a"}});n.done(function(t){e.style.display="block",i.style.display="none",r.style.display="none";var a=JSON.parse(t),n=a.data.link;e.innerHTML='<a href="'+n+'">'+n+"</a>"})}else e.style.display="none",i.style.display="none",r.style.display="block"},b=function(t){t.preventDefault(),h(event.dataTransfer.files[0])},y=function(t){t.preventDefault(),document.querySelector("#subidor").click()},v=function(t){var e=document.querySelector("#forum_form_message"),r=e.scrollTop,i=e.selectionStart,a=e.selectionEnd;e.value=e.value.substr(0,i)+t+e.value.substr(a,e.value.length),e.scrollTop=r},x=function(t){var e=t.target,r=e.getAttribute("src"),i="[image url="+r+"]";v(i)},S=function(t){var e="",r=prompt("Ingrese el usuario para la liga oficial o el ID de la liga amistosa");r&&(""==r?alert("No ha ingresado correctamente el usuario/id. Vuelva a intentarlo, por favor."):(e=isNaN(r)?"[image url=http://mzplus.info/imgdin_liga?user="+r+"]":"[image url=http://mzplus.info/imgdin_liga?user=&idla="+r+"]",v(e)))},w=function(t){var e=document.querySelector("#forum_form_message");e.value=""},k=function(t){var e=document.querySelector("#contenedor");"none"==e.style.display?(window.opera&&(e.innerHTML='<span style="color:red;padding:3px"> Opera no soporta la posibilidad de subir imágenes directamente. <br /><span style="color:green">&nbsp;Firefox s&iacute;, apoya una web libre! <a href="https://affiliates.mozilla.org/link/banner/12520/3/18"><img src="http://affiliates-cdn.mozilla.org/media/uploads/banners/download-small-blue-ES.png" class="cursor" /></a></span></span>'),e.style.display="block"):e.style.display="none"},A=function(){$(document).on("click","#btnUpImg",y).on("click",".js-icons-container img",x).on("click","#btnTabla",S).on("click","#upImg",k).on("click",".js-empty-post-textarea",w).on("dragover","#contenedor",f).on("drop","#contenedor",b).on("change","#subidor",function(){h(this.files[0])})},q=function(){var t=window.location.href.split("&");"sub=topics"!=t[1]&&"sub=topic"!=t[1]||setTimeout(function(){var t=document.querySelector(".bbcode");if(t){var e=g();t.insertAdjacentHTML("afterbegin",e),A()}},1e3)},T=function(){var t=window.location.href.split("&");if("sub=topic"==t[1])for(var e,r,i,a,n,o,l=document.querySelectorAll(".forum_body"),s=t[3].replace("forum_id=",""),c="",u=["Ir al GB","Posts recientes del usuario","Invitar amistoso"],p=["Guestbook","Posts","Amistosos"],d=0;d<l.length;d++)e=l[d].querySelector(".post-author"),r=e.querySelector("a"),i=r.href.split("&")[1].replace("uid=",""),a=r.innerHTML,o=l[d].querySelector(".forum-post-badges"),n=o.querySelector("img").src.split("=")[1].replace("&sport",""),c='<a class="quicklink" href="/?p=guestbook&uid='+i+'" title="'+u[0]+'">'+p[0]+'</a><a class="quicklink" href="?p=forum&sub=search&search_keywords=&search_keyword_type=any&search_author='+a+"&search_forum="+s+'&search_range=7&search_sort_by=post_date&search_sort_order=desc" title="'+u[1]+'">'+p[1]+'</a><a class="quicklink" href="?p=team&sub=challenge&tid='+n+'" title="'+u[2]+'">'+p[2]+"</a>",e.insertAdjacentHTML("beforeend",c)},j=function(){var t=window.location.href.split("&");if("sub=scheduled"==t[1]){var e=document.querySelector("#results-fixtures-header"),r='<div class="js-preview-results" style="float:right;cursor:pointer;border:2px solid #2A4CB0;width:20px;height:20px;padding:4px 0 0 4px;"><img src="http://i.imgur.com/WL38HPq.png" title="Ver resultados" alt="Ver resultados"/></div>';e.insertAdjacentHTML("afterbegin",r),$(document).on("click",".js-preview-results",M)}},M=function(e){for(var r,i,a,n=document.querySelectorAll("#fixtures-results-list > dd"),o=!1,l=0;l<n.length;l++)i=n[l].querySelectorAll("dl.action-panel a"),o=i.length>1,o&&(r=i[0].href.split("&")[3].split("=")[1],a=$.ajax({url:"/xml/match_info.php",type:"GET",data:{sport_id:t.indexOf(ajaxSport),match_id:r}}),function(t){a.done(function(e){var r={local:e.getElementsByTagName("Team")[0].getAttribute("goals"),visitor:e.getElementsByTagName("Team")[1].getAttribute("goals")},i=t.querySelector(".score-cell-wrapper > a"),a=i.href.split("&")[2].split("=")[1];i.innerHTML=r.local+" - "+r.visitor,r.local==r.visitor?i.className="yellow":a==e.getElementsByTagName("Team")[0].getAttribute("id")?r.local>r.visitor?i.className="green":i.className="red":a==e.getElementsByTagName("Team")[1].getAttribute("id")&&(r.local<r.visitor?i.className="green":i.className="red")})}(n[l]))},_=function(){var t,e,r=window.location.href.split("="),i=["private_cup&sub","cup&sub"],a=["friendlyseries&sub"];(i.indexOf(r[1])>-1||a.indexOf(r[1])>-1)&&(i.indexOf(r[1])>-1?(t="#cup-div",e="#ui-id-4"):a.indexOf(r[1])>-1&&(t="#friendly-series-div",e="#ui-id-2","standings&fsid"==r[2]&&setTimeout(function(){O()},1e3)),$(document).on("click",".js-view-div-country",function(){i.indexOf(r[1])>-1?D("#group-stages"):a.indexOf(r[1])>-1&&D("#ui-tabs-2")}),$(t).on("click",e,function(){setTimeout(function(){O()},1e3)}))},O=function(){var t=document.querySelectorAll(".nice_table thead tr.seriesHeader")[0],e=t.cells[0];e.innerHTML='<img class="js-view-div-country" src="http://i.imgur.com/IwaQRmF.png" title="Ver divisi&oacute;n y pa&iacute;s" style="cursor:pointer;">'},D=function(e){var r,i,a,n,o=document.querySelector(e);if(o)for(var l=o.querySelectorAll(".nice_table tbody > tr"),s=0;s<l.length;s++)r=l[s],i=r.querySelectorAll("a")[0],a=i.href.split("&")[1].replace("tid=",""),n=$.ajax({url:"/xml/manager_data.php",type:"GET",data:{sport_id:t.indexOf(ajaxSport),team_id:a}}),function(e){n.done(function(r){var i=t.indexOf(ajaxSport)-1,a=r.getElementsByTagName("Team")[i].getAttribute("seriesName"),n=r.getElementsByTagName("UserData")[0].getAttribute("countryShortname"),o=r.getElementsByTagName("Team")[i].getAttribute("seriesId"),l=r.getElementsByTagName("Team")[i].getAttribute("teamId"),s='<img src="http://static.managerzone.com/nocache-581/img/flags/12/'+n.toLowerCase()+'.png">&nbsp;',c='&nbsp;- &gt; <a href="?p=league&type=senior&sid='+o+"&tid="+l+'">'+a+"</a>";e.insertAdjacentHTML("beforeend",c),e.insertAdjacentHTML("afterbegin",s)})}(i.parentNode)},C=function(){var t=window.location.href;if(t.indexOf("scheduled")>-1||t.indexOf("played")>-1)for(var e,r,i,a,n,o=document.querySelectorAll("#fixtures-results-list > dd"),l=t.indexOf("played")!=-1?1:0,s=!o[0].querySelectorAll("a")[0],c=!l&&s?1:0,u="",p="",d=c;d<o.length;d++)e=o[d],"group"!=e.className&&(n=0,u="",p="",r=e.querySelectorAll("dd.teams-wrapper a"),a=r[1].href.split("&")[2].split("=")[1],i=r[1].href.split("&")[3].split("=")[1],r[0].href.indexOf("&tid")>-1?n=r[0].href.split("=")[2]:r[2].href.indexOf("&tid")>-1&&(n=r[2].href.split("=")[2]),u='<a class="quicklink" href="http://www.mzcompare.com/match?played='+l+"&tid="+a+"&mid="+i+'" target="_blank" title="Comparar equipos con MZ Compare">MZC</a>',n>0&&(p='<a class="quicklink" href="http://mzplus.info/i?eq='+n+'" target="_blank" title="Mirar rival en MZPlus">MZP</a>'),e.querySelector(".action-panel dd").insertAdjacentHTML("beforeend",u+p))},I=function(t){$.inArray(t.keyCode,[46,8,9,27,13])!==-1||65==t.keyCode&&t.ctrlKey===!0||67==t.keyCode&&t.ctrlKey===!0||88==t.keyCode&&t.ctrlKey===!0||t.keyCode>=35&&t.keyCode<=39||(t.shiftKey||t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)&&t.preventDefault()},z=function(t){for(var e={},r=t.querySelectorAll("input, select, textarea"),i=0;i<r.length;++i){var a=r[i],n=a.name,o=a.value;n&&(e[n]=o.trim())}return JSON.stringify(e)},N=function(t){var e=new Date(t);return e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e},L=function(t){var e=t.split("-");return e[2]+"-"+e[1]+"-"+e[0]},H=function(t,e){var r=864e5;return(N(e)-N(t))/r},P=function(t){var e=H(L(t.boughtDate),L(t.soldDate)),r={value:0,percentage:0},i=t.soldPrice-t.boughtPrice;return e<0?alert("Por favor revise las fechas ingresadas"):i>0&&(t.originalPlayer?r.percentage=15:t.exYouth?19==t.playerAge?r.percentage=25:20==t.playerAge?r.percentage=20:t.playerAge>20&&(r.percentage=15):e>70?r.percentage=15:e>27?r.percentage=50:r.percentage=95,r.value=Math.round(i*(r.percentage/100))),r},E=function(t){t.preventDefault();var e=t.target,r=z(e);r=JSON.parse(r);var i={originalPlayer:1*r.origin==2,exYouth:1*r.origin==1,playerAge:1*r.playerAge,boughtDate:r.boughtDate,soldDate:r.soldDate,boughtPrice:1*r.origin==0?1*r.boughtValue:r.playerValue,soldPrice:1*r.soldValue},a=P(i),n="Se descuentan "+c(a.value)+" en impuestos ("+a.percentage+"%)<br>Recibes "+c(i.soldPrice-a.value);document.querySelector(".js-tax-result").innerHTML=n},F=function(){return'<article style="padding-left:5px;"><h3>Calcular impuestos</h3><div><form class="js-calculate-tax"><table style="width:100%;"><tr><td><span>Origen jugador</span></td><td><select name="origin"><option value="0">Comprado</option><option value="1">Ex juvenil</option><option value="2">Original del club</option></select></td></tr><tr><td><span>Valor jugador</span> <span style="color:#A3A30D;">*</span></td><td><input type="text" name="playerValue" value="0" class="js-only-numbers"></td></tr><tr><td><span>Edad jugador</span> <span style="color:#A3A30D;">*</span></td><td><select name="playerAge"><option value="19">19</option><option value="20">20</option><option value="21">M&aacute;s de 20</option></select></td></tr><tr><td><span>Valor compra</span> <span style="color:#FF043D;">*</span></td><td><input type="text" name="boughtValue" class="js-only-numbers"></td></tr><tr><td><span>Valor venta</span></td><td><input type="text" name="soldValue" class="js-only-numbers"></td></tr><tr><td><span>Fecha compra</span> <span style="color:#FF043D;">*</span></td><td><input type="text" name="boughtDate" placeholder="dd-mm-aaaa"></td></tr><tr><td><span>Fecha venta</span></td><td><input type="text" name="soldDate" placeholder="dd-mm-aaaa"></td></tr></table><div><span style="color:#FF043D;">*</span> <span>Si el jugador fue comprado</span><br><span style="color:#A3A30D;">*</span> <span>Si el jugador es original del club o ex juvenil</span></div><div style="margin-top:4px;"><button type="submit" class="quicklink"><span class="buttonClassMiddle">Calcular</span></button></div><div><p class="js-tax-result"></p></div></form></div></article>'},R=function(t){t.preventDefault();var e=F(),r=document.querySelector(".dg_playerview_info");r.insertAdjacentHTML("beforeend",e)},V=function(){var t=window.location.href.split("=");if("players&pid"==t[1]){var e=document.querySelector(".dg_playerview_info"),r=e.querySelector("p"),i='<a href="#" class="js-render-tax mzbtn buttondiv button_red"><span class="buttonClassMiddle" style="white-space:nowrap;">Impuestos</span><span class="buttonClassRight">&nbsp;</span></a>';r.insertAdjacentHTML("beforeend",i),$(document).on("click",".js-render-tax",R).on("submit",".js-calculate-tax",E).on("keydown change",".js-only-numbers",I)}},B=function(){for(var t=["ar","at","biz","bo","br","ch","cl","co","com","cr","cz","de","dk","do","ec","edu","es","eu","fm","fr","gb","gov","gr","gt","hn","hr","ie","info","int","it","jobs","lt","lv","ly","mx","mz","net","ni","org","pa","pe","pl","pr","pt","py","ro","ru","sv","se","th","tk","tn","to","tr","tv","tz","uk","us","uy","ve","vg","xxx","yu","zw"],e=["a","applet","area","embed","frame","frameset","head","iframe","img","map","meta","noscript","object","option","param","script","select","style","textarea","title"],r=/(^|[\s()\[\]_:~+@*"'>])((?:https?|ftp|irc):\/\/)?([-a-z\d;:&=+$,%_.!~*'()]+@)?((?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:(www|irc|ftp)\.)?(?:(?:[a-z\d]|[a-z\d][a-z\d-]*[a-z\d])\.)+([a-z]{2,6}))(:\d+)?(\/(?:[-\w.!~*'()%:@&=+$,;\/]*[\w~*%@&=+$\/])?(?:\?(?:[-\w;\/?:@&=+$,.!~*'()%\[\]|]*[\w\/@&=+$~*%])?)?(?:#(?:[-\w;\/?:@&=+$,.!~*'()%]*[\w\/@&=+$~*%])?)?|\b)/i,i=0,a=document.body;a;){if("#text"==a.nodeName&&(match=a.nodeValue.match(r))&&t.indexOf(match[6])>-1){var n;if(n=!match[3]||match[2]||match[5]||match[8]||match[3].indexOf(":")!=-1&&0!=match[3].indexOf("mailto:")?(match[2]?match[2]:(match[5]&&"www"!=match[5]?match[5]:"http")+"://")+(match[3]?match[3]:"")+match[4]+(match[7]?match[7]:"")+(match[8]?match[8]:""):(match[3].indexOf("mailto:")==-1?"mailto:":"")+match[3]+match[4]){var o=document.createRange();o.setStart(a,match.index+match[1].length),o.setEnd(a,match.index+match[0].length);var l=document.createElement("a");l.setAttribute("href",n),l.appendChild(o.extractContents()),o.insertNode(l),o.detach(),i++}}if(a.tagName&&e.indexOf(a.tagName.toLowerCase())<0&&a.firstChild)a=a.firstChild;else if(a.nextSibling)a=a.nextSibling;else{do a=a.parentNode;while(!a.nextSibling&&a.parentNode);a=a.nextSibling}}},U=function(){var t;return localStorage.getItem("userSignature")?t=localStorage.getItem("userSignature"):localStorage.getItem("firmaMZ")&&(t=localStorage.getItem("firmaMZ")),t},K=function(){var t=window.location.href;(t.indexOf("topics&forum_id")>-1||t.indexOf("topic&topic_id")>-1||t.indexOf("guestbook")>-1)&&(setTimeout(function(){var t=U(),e=document.querySelector(".bbcode");t&&localStorage.getItem("showAlwaysUserSignature")&&Q(t,!1);var r='<form class="js-signature-form"><table style="width:100%;"><tr><td><span>Texto</span> <small>(Usa bbcode)</small></td></tr><tr><td><textarea name="signature" cols="69" rows="5" style="padding:5px;">'+(t?t:"")+'</textarea></td></tr><tr><td><button type="button" class="quicklink js-signature">Agregar firma</button><button type="button" class="quicklink js-save-signature">Guardar firma</button><button type="button" class="quicklink js-delete-signature">Borrar firma</button></td></tr></form>';e.insertAdjacentHTML("beforeend",r)},1200),$(document).on("click",".js-signature",W).on("click",".js-save-signature",J).on("click",".js-delete-signature",G))},Z=function(t){var e=localStorage.getItem("userSignature");e!=t&&localStorage.setItem("userSignature",t)},G=function(){localStorage.removeItem("userSignature"),localStorage.removeItem("showAlwaysUserSignature"),alert("La firma fue eliminada")},J=function(){var t=document.querySelector(".js-signature-form");t=z(t),t=JSON.parse(t);var e=t.signature;e=e.replace(/^(\s|\&nbsp;)*|(\s|\&nbsp;)*$/g,""),""!=e&&e.length>0&&null!=e&&Z(e);var r=window.confirm("Mostrar siempre?");r?localStorage.setItem("showAlwaysUserSignature",r):localStorage.removeItem("showAlwaysUserSignature")},Y=function(t){if(t.setSelectionRange)t.focus(),t.setSelectionRange(0,0);else if(t.createTextRange){var e=t.createTextRange();e.moveStart("character",0),e.select()}},Q=function(t,e){var r=document.querySelector(".markItUpEditor"),i=!0;e||""!=r.value&&(i=!1),i&&(r.value+="\r\n\r\n---------------------------------------------------\r\n"+t,Y(r))},W=function(t){t.preventDefault();var e=document.querySelector(".js-signature-form");e=z(e),e=JSON.parse(e);var r=e.signature;r=r.replace(/^(\s|\&nbsp;)*|(\s|\&nbsp;)*$/g,""),""!=r&&r.length>0&&null!=r&&Q(r,!0)};return{init:e}}();rzscript.init();